<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Docker Volume Backup</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification hidden"></div>
    
    <div class="container">
        <header>
            <div class="header-top">
                <h1>üê≥ Simple Docker Volume Backup</h1>
                <div class="menu-container">
                    <button id="settingsBtn" class="menu-btn" title="Menu">‚öôÔ∏è</button>
                    <div id="settingsMenu" class="dropdown-menu hidden">
                        <button id="settingsLink" class="menu-item">‚öôÔ∏è Backup Settings</button>
                    </div>
                </div>
            </div>
            <p>Schedule automated backups of your Docker volumes</p>
        </header>

        <main>
            <section class="jobs-section">
                <div class="jobs-header">
                    <h2>Backup Jobs</h2>
                </div>
                <div id="jobsList" class="jobs-list"></div>
                <div class="jobs-actions">
                    <button id="addJobBtn" class="btn-primary">+ Add a Backup Job</button>
                    <button id="restoreBtn" class="btn-restore">Restore from Backup</button>
                </div>
            </section>

            <section class="form-section hidden" id="formSection">
                <h2>Schedule New Backup</h2>
                <form id="jobForm">
                    <div class="form-group">
                        <label for="backupLabel">Backup Label:</label>
                        <input type="text" id="backupLabel" placeholder="e.g., database, app-data, media" required>
                        <small>A descriptive name for the volume(s) being backed up</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="useRclone">
                            Use Rclone for remote backup
                        </label>
                    </div>

                    <div class="form-group hidden" id="remoteGroup">
                        <label for="remote">Rclone Remote:</label>
                        <input type="text" id="remote" placeholder="e.g., s3, gdrive, azure">
                        <small>The rclone remote to backup to</small>
                    </div>

                    <div class="form-group" id="retentionGroup">
                        <label for="retentionCount">Keep Backups:</label>
                        <input type="number" id="retentionCount" min="1" max="100" value="5" placeholder="Number of backups to keep">
                        <small>Number of backups to keep locally (oldest will be deleted). Not applicable for rclone backups.</small>
                    </div>

                    <div class="form-group">
                        <label for="frequency">Backup Frequency:</label>
                        <select id="frequency" required>
                            <option value="">-- Select Frequency --</option>
                            <option value="hourly">Hourly (every hour)</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="custom">Custom Cron Expression</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="dailyTimeGroup">
                        <label for="dailyTime">Time of Day:</label>
                        <input type="time" id="dailyTime" value="00:00">
                        <small>What time each day should the backup run?</small>
                    </div>

                    <div class="form-group hidden" id="weeklyScheduleGroup">
                        <label for="weeklyDay">Day of Week:</label>
                        <select id="weeklyDay">
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                        <label for="weeklyTime" style="margin-top: 10px;">Time of Day:</label>
                        <input type="time" id="weeklyTime" value="00:00">
                        <small>What day and time each week should the backup run?</small>
                    </div>

                    <div class="form-group hidden" id="monthlyScheduleGroup">
                        <label for="monthlyDay">Day of Month:</label>
                        <input type="number" id="monthlyDay" min="1" max="31" value="1">
                        <label for="monthlyTime" style="margin-top: 10px;">Time of Day:</label>
                        <input type="time" id="monthlyTime" value="00:00">
                        <small>What day and time each month should the backup run?</small>
                    </div>

                    <div class="form-group hidden" id="customCronGroup">
                        <label for="customCron">Cron Expression:</label>
                        <input type="text" id="customCron" placeholder="e.g., 0 2 * * * (2 AM daily)">
                        <small>Format: minute hour day month day-of-week</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enabled" checked>
                            Enable this backup schedule
                        </label>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn-primary">Create Backup Schedule</button>
                        <button type="button" class="btn-secondary" id="cancelFormBtn">Cancel</button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Edit Backup Schedule</h2>
            <form id="editForm">
                <input type="hidden" id="editJobId">
                
                <div class="form-group">
                    <label for="editBackupLabel">Backup Label:</label>
                    <input type="text" id="editBackupLabel" required>
                    <small>A descriptive name for the volume(s) being backed up</small>
                </div>

                <div class="form-group">
                    <label for="editFrequency">Backup Frequency:</label>
                    <select id="editFrequency" required>
                        <option value="">-- Select Frequency --</option>
                        <option value="hourly">Hourly (every hour)</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="custom">Custom Cron Expression</option>
                    </select>
                </div>

                <div class="form-group hidden" id="editDailyTimeGroup">
                    <label for="editDailyTime">Time of Day:</label>
                    <input type="time" id="editDailyTime" value="00:00">
                    <small>What time each day should the backup run?</small>
                </div>

                <div class="form-group hidden" id="editWeeklyScheduleGroup">
                    <label for="editWeeklyDay">Day of Week:</label>
                    <select id="editWeeklyDay">
                        <option value="0">Sunday</option>
                        <option value="1">Monday</option>
                        <option value="2">Tuesday</option>
                        <option value="3">Wednesday</option>
                        <option value="4">Thursday</option>
                        <option value="5">Friday</option>
                        <option value="6">Saturday</option>
                    </select>
                    <label for="editWeeklyTime" style="margin-top: 10px;">Time of Day:</label>
                    <input type="time" id="editWeeklyTime" value="00:00">
                    <small>What day and time each week should the backup run?</small>
                </div>

                <div class="form-group hidden" id="editMonthlyScheduleGroup">
                    <label for="editMonthlyDay">Day of Month:</label>
                    <input type="number" id="editMonthlyDay" min="1" max="31" value="1">
                    <label for="editMonthlyTime" style="margin-top: 10px;">Time of Day:</label>
                    <input type="time" id="editMonthlyTime" value="00:00">
                    <small>What day and time each month should the backup run?</small>
                </div>

                <div class="form-group hidden" id="editCustomCronGroup">
                    <label for="editCustomCron">Cron Expression:</label>
                    <input type="text" id="editCustomCron" placeholder="e.g., 0 2 * * * (2 AM daily)">
                    <small>Format: minute hour day month day-of-week</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editUseRclone">
                        Use Rclone for remote backup
                    </label>
                </div>

                <div class="form-group hidden" id="editRemoteGroup">
                    <label for="editRemote">Rclone Remote:</label>
                    <input type="text" id="editRemote" placeholder="e.g., s3, gdrive, azure">
                    <small>The rclone remote to backup to</small>
                </div>

                <div class="form-group" id="editRetentionGroup">
                    <label for="editRetentionCount">Keep Backups:</label>
                    <input type="number" id="editRetentionCount" min="1" max="100" value="5" placeholder="Number of backups to keep">
                    <small>Number of backups to keep locally (oldest will be deleted). Not applicable for rclone backups.</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editEnabled">
                        Enable this backup schedule
                    </label>
                </div>

                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-secondary" id="cancelEditBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content settings-modal-wide">
            <div class="modal-header">
                <h2>Settings</h2>
                <span class="close" id="settingsClose">&times;</span>
            </div>
            <form id="settingsForm">
                <!-- Theme Section -->
                <fieldset>
                    <legend>Appearance</legend>
                    <div class="form-group">
                        <label for="backgroundGradient">Background Gradient:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="color" id="backgroundGradientStart" value="#1a1a2e" title="Gradient Start Color">
                            <span>to</span>
                            <input type="color" id="backgroundGradientEnd" value="#16213e" title="Gradient End Color">
                        </div>
                        <small>Choose start and end colors for the background gradient</small>
                    </div>
                </fieldset>

                <!-- Backup Name Schema Section -->
                <fieldset>
                    <legend>Backup Naming</legend>
                    <div class="form-group">
                        <label for="backupNameSchema">Backup Name Schema:</label>
                        <input type="text" id="backupNameSchema" placeholder="e.g., backup_{label}_{date}" required>
                        <small>Available variables: {label}, {date}, {time}, {timestamp}</small>
                    </div>

                    <div class="form-group">
                        <p><strong>Example:</strong> <span id="schemaPreview">backup_myvolume_20251224</span></p>
                    </div>
                </fieldset>

                <!-- Ignore Patterns Section -->
                <fieldset>
                    <legend>Ignore Patterns (Regex)</legend>
                    <p style="font-size: 0.9em; color: #999; margin-bottom: 15px;">Volumes matching these patterns will be excluded from backups</p>
                    
                    <div id="ignorePatternsList"></div>
                    
                    <div style="margin-top: 15px;">
                        <button type="button" class="btn-secondary" id="addPatternBtn">+ Add Pattern</button>
                    </div>
                </fieldset>

                <!-- Rclone Config Section -->
                <fieldset>
                    <legend>Rclone Configuration</legend>
                    <div class="form-group">
                        <label for="rcloneConfig">Rclone Config:</label>
                        <textarea id="rcloneConfig" placeholder="Paste your rclone.conf contents here" style="font-family: monospace; height: 150px;"></textarea>
                        <small>Edit and save your rclone configuration directly in the web UI</small>
                    </div>
                </fieldset>

                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Save Settings</button>
                    <button type="button" class="btn-secondary" id="cancelSettingsBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Restore Modal -->
    <div id="restoreModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Restore from Backup</h2>
                <span class="close" id="restoreClose">&times;</span>
            </div>

            <div id="restoreStep1" class="restore-step">
                <p>Select a backup job label:</p>
                <select id="restoreLabelSelect">
                    <option value="">-- Loading labels --</option>
                </select>
                <div class="restore-buttons">
                    <button type="button" class="btn-primary" id="restoreLabelNextBtn">Next</button>
                    <button type="button" class="btn-secondary btn-cancel" id="restoreCloseBtn">Cancel</button>
                </div>
            </div>

            <div id="restoreStep2" class="restore-step hidden">
                <p>Select a backup to restore:</p>
                <select id="restoreBackupSelect">
                    <option value="">-- Loading backups --</option>
                </select>
                <div class="restore-buttons">
                    <button type="button" class="btn-primary" id="restoreBackupBtn">Restore</button>
                    <button type="button" class="btn-secondary btn-cancel" id="restoreBackBtn">Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content confirm-modal">
            <h2 id="confirmTitle">Confirm Action</h2>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button id="confirmYes" class="btn-primary">Yes, Delete</button>
                <button id="confirmNo" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal hidden">
        <div class="modal-content confirm-modal">
            <h2 id="infoTitle">Success</h2>
            <p id="infoMessage"></p>
            <div class="modal-buttons">
                <button id="infoOk" class="btn-primary">OK</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
